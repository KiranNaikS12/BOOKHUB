<%- include('../layout/header') %>
<style>
    .title-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.dropdown-wrapper {
    margin-left: auto; 
}
</style>
<body>
    <div class="screen-overlay"></div>
    <main class="main-wrap">
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Dashboard </h2>
                </div>
                <!-- <div>
                    <a href="#" class="btn btn-primary"><i class="text-muted material-icons md-post_add"></i>Create report</a>
                </div> -->
            </div>
            <div class="row">
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-monetization_on"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Total Revenue</h6>
                                <span>Rs.<%= totalRevenue  %></span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Total Orders</h6> 
                                <span><%= totalOrders  %></span>
                                
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Total Products</h6> 
                                <span><%= totalProducts  %></span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
                            <div class="text">
                                <div class="title-wrapper">
                                    <h6 class="mb-1 card-title">Earnings</h6>
                                    <div class="dropdown-wrapper">
                                        <label for="earningInterval"></label>
                                        <select id="earningInterval">
                                            <option value="">Filter</option>
                                            <option value="monthly">Yearly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="daily">Daily</option>
                                        </select>
                                    </div>
                                </div>
                                <span id="totalRevenue">Rs.00.00/-</span>
                            </div>
                        </article>
                    </div>
                </div>                
            </div>
            <!-- <div class="row">
                <div class="col-xl-8 col-lg-12">
                    <div class="card mb-4">
                        <article class="card-body">
                            <h5 class="card-title">Sale statistics</h5>
                            <canvas id="myChart" height="120px"></canvas>
                        </article>
                    </div>
                </div>   
            </div> -->
            </div>
        </section>
    </main>
    <script src="/assets-admin/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/assets-admin/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/assets-admin/js/vendors/select2.min.js"></script>
    <script src="/assets-admin/js/vendors/perfect-scrollbar.js"></script>
    <script src="/assets-admin/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="/assets-admin/js/vendors/chart.js"></script>
    <!-- Main Script -->
    <script src="/assets-admin/js/main.js" type="text/javascript"></script>
    <script src="/assets-admin/js/custom-chart.js" type="text/javascript"></script>
    <script>
        document.getElementById('earningInterval').addEventListener('click', function (event){
            const filterOption = event.target.value;
            let url = '/admin/filter/revenue';

            if(filterOption) {
            url += `?interval=${filterOption}`;
            
            fetchRevenue(url)
           }
        })

        function fetchRevenue(url){
            fetch(url)
                 .then(response => {
                    if(!response.ok){
                        throw new Error('Network response was not ok');
                    }
                    return response.json()
                 })
                 .then(data => {
                    updateRevenueList(data)
                 })
                 .catch(error => {
                    console.log('Error fetching the data', error.message)
                 })         
        }

        function updateRevenueList(data){
            const totalRevenueSpan = document.getElementById('totalRevenue');

            if(data  !== undefined){
                totalRevenueSpan.textContent = `Rs.${data}/-`;
            }else{
                console.log('Invalid data format received for total revenue');
            }
        }
    </script>
</body>
</html>